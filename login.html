<!DOCTYPE html>
<html lang="en">
<head>
    <title>Login</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="login/login.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script>
        $(document).ready(function() {
            // Toggle password visibility
            $(".toggle-password").click(function() {
                $(this).toggleClass("fa-eye fa-eye-slash");
                if ($('#password-field').attr("type") === "password") {
                    $('#password-field').attr("type", "text");
                } else {
                    $('#password-field').attr("type", "password");
                }
            });

            // Handle form submission
            $('#loginForm').submit(function(event) {
                event.preventDefault(); // Prevent the default form submission

                // Get form values
                const username = $('#username').val();
                const password = $('#password-field').val();
                const userType = $('#user-type').val(); // Get user type from the select dropdown

                // Debugging output
                console.log('Username:', username);
                console.log('Password:', password);
                console.log('User Type:', userType);

                // Send AJAX request
                $.ajax({
                    url: 'https://6uzb5resq5.execute-api.us-east-1.amazonaws.com/dev/login', // Your API Gateway URL
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ username, password }), // Do not send userType in the request
                    success: function(response) {
                        console.log("Response:", response); // Debugging response
                        alert(response.message);

                        // Redirect based on user role
                        if (response.success && response.role) {
                            if (response.role === 'employee') {
                                window.location.href = 'employee_dashboard.html'; // Redirect to Employee dashboard
                            } else if (response.role === 'admin') {
                                window.location.href = 'admin_dashboard.html'; // Redirect to Admin dashboard
                            }
                        } else {
                            alert('Login failed. Please check your credentials.');
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.error("Error Status:", textStatus);
                        console.error("Error Thrown:", errorThrown);
                        console.error("Response Text:", jqXHR.responseText);

                        let errorMessage = 'Login failed. Please try again.';
                        try {
                            const response = JSON.parse(jqXHR.responseText);
                            errorMessage = response.message || errorMessage;
                        } catch (e) {
                            console.error("Failed to parse response as JSON:", e);
                        }
                        alert(errorMessage);
                    }
                });
            });
        });
    </script>
</head>
<body class="bg">
    <section>
        <div class="login">
            <div class="wrapper-lg">
                <div class="text-center">
                    <img src="login/img/f13tech_logo.jfif" style="width: 50%;" alt="Logo" title="Logo"/>
                </div>
                <div class="login-info">
                    <form id="loginForm"> <!-- Added id for the form -->
                        <div class="floating-label">      
                            <input id="username" class="floating-input" type="text" placeholder=" " required>
                            <span class="highlight"></span>
                            <label class="labelnew">Email*</label>
                        </div>
                        <div class="floating-label">      
                            <input class="floating-input" id="password-field" type="password" placeholder=" " required>
                            <span class="highlight"></span>
                            <label class="labelnew">Password*</label>
                            <i class="fa fa-eye-slash iconfirst toggle-password" aria-hidden="true"></i>
                        </div>
                        <div class="floating-label">
                            <select id="user-type" class="floating-input">
                                <option value="employee">Employee</option>
                                <option value="admin">Admin</option>
                            </select>
                            <span class="highlight"></span>
                            <label class="labelnew">User Type*</label>
                        </div>
                        <div class="col-md-12 padding0">
                            <div class="col-xs-12 padding0">
                                <div class="checkbox checkbox-primary">
                                    <input type="checkbox" id="checkbox2">
                                    <label for="checkbox2" style="padding-left:5px;"> Remember me </label>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="col-md-12 padding0">
                            <div class="col-md-12 text-center martop20 padding0"> 
                                <button type="submit" class="btn btn-primary btn-block myBtn" style="background: #D71996; border: #D71996;">LOGIN</button>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>
</body>
</html>
